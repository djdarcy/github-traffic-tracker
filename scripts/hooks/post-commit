#!/bin/bash
#
# Post-commit hook for GitHub Traffic Tracker
# Updates version files with the actual commit hash after commit is created
#

# Find the repository root
REPO_ROOT="$(git rev-parse --show-toplevel 2>/dev/null || pwd)"

# Use sync-versions.py to update __version__ strings with new commit hash
SYNC_SCRIPT="$REPO_ROOT/scripts/sync-versions.py"
if [ -f "$SYNC_SCRIPT" ]; then
    # Run without --auto (uses smart date detection for post-commit context)
    # --no-git-ver would skip this, so we run the full sync quietly
    python "$SYNC_SCRIPT" > /dev/null 2>&1
    echo "âœ“ Version updated with commit hash $(git rev-parse --short HEAD)"
else
    echo "Warning: Could not find scripts/sync-versions.py"
fi

exit 0